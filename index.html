<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Toplu ÃœrÃ¼n YÃ¼kleme - OluÅŸtur</title>
<style>
  :root{
    --accent:#f57c00;
    --muted:#f1f1f1;
    --danger:#8b0000;
    --card:#fff;
    --shadow: 0 6px 18px rgba(0,0,0,0.08);
    font-family: Inter, system-ui, Arial, sans-serif;
  }
  body{background:#fafafa;margin:28px;display:flex;justify-content:center}
  .card{width:680px;background:var(--card);box-shadow:var(--shadow);border-radius:8px;padding:18px}
  .header{font-weight:700;text-align:center;padding:6px 0;margin-bottom:8px}
  .grid{display:grid;grid-template-columns:160px 1fr;gap:12px;align-items:center}
  label{font-weight:600}
  select,input{width:100%;padding:10px;border-radius:6px;border:1px solid #ddd;background:#fff;box-sizing:border-box}
  .prefix{width:140px}
  .big-btn{display:inline-block;background:var(--danger);color:#fff;padding:12px 22px;border-radius:6px;border:none;font-weight:700;cursor:pointer}
  .create-row{display:flex;justify-content:center;padding-top:8px}
  .result{margin-top:10px;text-align:center;font-size:14px;color:#444}
  .link{display:inline-block;margin-top:8px}
  .small-muted{font-size:12px;color:#777;margin-top:6px}
  .top-row{display:flex;gap:10px;align-items:center}
  .market-badge{background:var(--accent);color:#fff;padding:6px 10px;border-radius:6px;font-weight:700}
  .form-row{padding:8px 0}
  .spinner{display:inline-block;width:18px;height:18px;border:3px solid #fff;border-radius:50%;border-top-color:rgba(255,255,255,0.4);animation:spin .9s linear infinite;margin-left:8px;vertical-align:middle}
  @keyframes spin{to{transform:rotate(360deg)}}
  .error{color:#b00020;font-weight:600}
  /* responsive */
  @media (max-width:720px){.card{width:94%}}
</style>
</head>
<body>
  <div class="card" role="main">
    <div class="top-row">
      <div style="flex:1">
        <div class="header">TOPLU ÃœRÃœN YÃœKLEME DOSYASI OLUÅTUR</div>
      </div>
      <!-- Ã¶rnek gÃ¶rÃ¼ntÃ¼ (yerel dosya yolu) -->
      <div style="width:160px;text-align:right">
        <img alt="Ã¶rnek" src="/mnt/data/Ekran gÃ¶rÃ¼ntÃ¼sÃ¼ 2025-11-21 180135.png" style="max-width:100%;border-radius:6px" />
      </div>
    </div>

    <form id="createForm" class="grid" autocomplete="off">
      <div class="form-row"><label for="market">Pazaryeri</label></div>
      <div class="form-row">
        <select id="market" required>
          <option value="Hepsiburada">Hepsiburada</option>
          <option value="Trendyol">Trendyol</option>
        </select>
      </div>

      <div class="form-row"><label for="kategori">Kategori</label></div>
      <div class="form-row">
        <select id="kategori" required>
          <!-- istediÄŸin kategori seÃ§eneklerini ekle -->
          <option value="Elbise">Elbise</option>
          <option value="Bluz">Bluz</option>
          <option value="Pantolon">Pantolon</option>
          <option value="AyakkabÄ±">AyakkabÄ±</option>
        </select>
      </div>

      <div class="form-row"><label for="prefix">Barkod Ã–n Ek (Ã–rn: DRP)</label></div>
      <div class="form-row">
        <input id="prefix" placeholder="Ã–rn: DRP" />
      </div>

      <div class="form-row"><label for="brand">Marka AdÄ± (isteÄŸe baÄŸlÄ±)</label></div>
      <div class="form-row">
        <input id="brand" placeholder="Marka" />
      </div>

      <div style="grid-column:1 / -1" class="create-row">
        <button id="createBtn" class="big-btn" type="submit">OLUÅTUR</button>
      </div>

      <div style="grid-column:1 / -1">
        <div id="status" class="result">ilgili dosya</div>
        <div id="linkWrap" class="link"></div>
        <div id="error" class="small-muted error"></div>
        <div class="small-muted">Backend: <code id="backendUrl">http://localhost:5000/olustur</code></div>
      </div>
    </form>
  </div>

<script>
(() => {
  const form = document.getElementById('createForm');
  const btn = document.getElementById('createBtn');
  const status = document.getElementById('status');
  const linkWrap = document.getElementById('linkWrap');
  const errorBox = document.getElementById('error');
  const backendUrlElem = document.getElementById('backendUrl');

  // EÄŸer backend farklÄ± bir URL'deyse burada gÃ¼ncelle
  const BACKEND_URL = backendUrlElem.textContent.trim();

  function setLoading(loading){
    btn.disabled = loading;
    if(loading){
      btn.innerHTML = 'OluÅŸturuluyor <span class="spinner" aria-hidden="true"></span>';
      status.textContent = 'Ä°ÅŸlem sÃ¼rÃ¼yor...';
      errorBox.textContent = '';
      linkWrap.innerHTML = '';
    } else {
      btn.innerHTML = 'OLUÅTUR';
    }
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const kategori = document.getElementById('kategori').value.trim();
    const prefix = document.getElementById('prefix').value.trim();
    const market = document.getElementById('market').value.trim();
    const marka = document.getElementById('brand').value.trim();

    if(!kategori || !prefix || !market){
      errorBox.textContent = 'LÃ¼tfen pazaryeri, kategori ve prefix alanlarÄ±nÄ± doldur.';
      return;
    }

    setLoading(true);

    try {
      const payload = { kategori, prefix, market, marka };
      const res = await fetch(BACKEND_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      const data = await res.json();

      if(!res.ok){
        errorBox.textContent = data.error || data.detay || 'Sunucudan beklenmeyen bir cevap alÄ±ndÄ±.';
        status.textContent = 'Hata oluÅŸtu';
        setLoading(false);
        return;
      }

      // Backend indirme linki dÃ¶ndÃ¼rÃ¼yor
      const url = data.indirmeLinki || data.dosyaLinki || data.link || data.indirme_url || null;
      if(url){
        status.textContent = 'Dosya oluÅŸturuldu:';
        linkWrap.innerHTML = `<a href="${url}" target="_blank" rel="noopener">ğŸ“¥ DosyayÄ± indir / aÃ§</a>`;
      } else if(data.dosya && data.dosya.id) {
        // fallback: drive dokÃ¼man linki oluÅŸtur
        const fallback = `https://docs.google.com/spreadsheets/d/${data.dosya.id}`;
        status.textContent = 'Dosya oluÅŸturuldu:';
        linkWrap.innerHTML = `<a href="${fallback}" target="_blank" rel="noopener">ğŸ“¥ DosyayÄ± indir / aÃ§</a>`;
      } else {
        status.textContent = 'Ä°ÅŸlem tamamlandÄ±, ancak indirme linki alÄ±namadÄ±.';
        linkWrap.innerHTML = `<pre style="white-space:pre-wrap">${JSON.stringify(data,null,2)}</pre>`;
      }

      errorBox.textContent = '';
    } catch (err) {
      console.error(err);
      errorBox.textContent = 'Ä°stek gÃ¶nderilirken bir hata oluÅŸtu. (Konsolu kontrol et)';
      status.textContent = 'Hata';
    } finally {
      setLoading(false);
    }
  });

  // isteÄŸe baÄŸlÄ±: enter ile prefix alanÄ±nÄ± temizle tuÅŸu
  document.getElementById('prefix').addEventListener('keydown', (e) => {
    if(e.key === 'Escape') e.target.value = '';
  });

})();
</script>
</body>
</html>








<div style="max-width:450px;margin:auto;padding:20px;border:1px solid #ccc;">
  <h2>Toplu ÃœrÃ¼n YÃ¼kleme DosyasÄ± OluÅŸtur</h2>

  <label>Pazaryeri:</label>
  <select id="pazaryeri">
    <option value="Hepsiburada">Hepsiburada</option>
    <option value="Trendyol">Trendyol</option>
  </select><br><br>

  <label>Kategori:</label>
  <select id="kategori">
    <option value="Bluz">Bluz</option>
    <option value="Elbise">Elbise</option>
    <option value="Mont">Mont</option>
  </select><br><br>

  <label>Barkod Ã–n Ek:</label>
  <input type="text" id="barkod" placeholder="Ã–rn: DRP" /><br><br>

  <button id="olusturBtn">OLUÅTUR</button>
  <p id="sonuc"></p>
</div>

{% comment %} 
AJAX Ä°ÅLEM â€“ Shopifyâ€™da Ã¶zel JS blok iÃ§inde olmalÄ±!
{% endcomment %}
<script>
document.getElementById('olusturBtn').addEventListener('click', function () {
  const data = {
    pazaryeri: document.getElementById("pazaryeri").value,
    kategori:  document.getElementById("kategori").value,
    barkod:    document.getElementById("barkod").value,
  };

  // GOOGLE SCRIPT URL BURAYA GELECEK ğŸ‘‡
  const apiUrl = "https://script.google.com/macros/s/AKfycbwTh6aeknp4p36gVmO8uw0TxRsf17AjTrZNfr2jsWszXYLrASToA9uZbtOVM1HxA7lwSg/exec";  

  document.getElementById("sonuc").innerHTML = "Ä°ÅŸleniyor...";

  fetch(apiUrl, {
    method: "POST",
    mode: "no-cors",        // Shopify CORS hatasÄ± yaÅŸamaman iÃ§in
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  })
  .then(res => res.text())  // no-cors olduÄŸunda .json Ã§alÄ±ÅŸmaz
  .then(res => {
    try {
      const json = JSON.parse(res);   // JSON formatÄ±nÄ± Ã§Ã¶zmeyi deniyoruz
      document.getElementById("sonuc").innerHTML = 
        `<a href="${json.url}" target="_blank">ğŸ“ DosyayÄ± Ä°ndir</a>`;
    } catch(e) {
      document.getElementById("sonuc").innerHTML = 
        "âš  Beklenmeyen cevap alÄ±ndÄ±. Backend JSON dÃ¶ndÃ¼rÃ¼yor mu?";
    }
  })
  .catch(err => {
    document.getElementById("sonuc").innerHTML = 
      "âŒ Bir hata oluÅŸtu. Console'u kontrol et.";
    console.error(err);
  });
});
</script>
